{
  "$id": "https://www.bfarm.de/schemas/genomde/RareDiseasesCase",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Rare Diseases Data Schema",
  "type": "object",
  "properties": {
    "diagnosisRD": {
     "$ref": "#/$defs/diagnosisRD"
    },
    "priorRD": {
     "$ref": "#/$defs/priorRD"
    }
  },
  "$defs": {
    "diagnosisRD": {
      "type": "object",
      "properties": {
        "phenotypes": {
          "type": "array",
          "items": {
            "type": "object",
            "description": "Phenotyping based on HPO",
            "properties": {
              "identifier": {
                "type": "string"
              },
              "code": {
                "description": "HP Ontology Code",
                "allOf": [
                  {
                    "$ref": "https://www.bfarm.de/schemas/genomde/data-types/Coding#"
                  },
                  {
                    "required": ["code"]
                  }
                ]
              }
            },
            "required": [
              "identifier",
              "code"
            ]
          },
          "minItems": 1
        },
        "HPOversion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Version HP Ontology in format x.y.z (e.g. 2.0.4)"
        },
        "symptomOnsetDate": {
          "type": "string",
          "description": "Start of symptoms",
          "pattern": "^[0-9]{4}-(0[1-9]|1[0-2])$"
        },
        "molecularBoardDecisionDate": {
          "type": "string",
          "format": "date",
          "description": "Case conference date"
        },
        "diagnosticExtent": {
          "type": "string",
          "enum": [
            "singleGenome",
            "duoGenome",
            "trioGenome"
          ],
          "description": "Diagnostics recommendation"
        },
        "diagnosticAssessment": {
          "type": "string",
          "enum": [
            "noGeneticDiagnosis",
            "geneticSuspectedDiagnosis",
            "furtherGeneticDiagnosticsRecommended",
            "geneticDiagnosisConfirmed",
            "clinicalPhenotypeOnlyPartiallyResolved"
          ],
          "description": "Assessment of genetic diagnostics"
        },
        "diagnosis": {
          "type": "array",
          "description": "ICD10 mandatory, ORPHACode mandatory, Alpha ID mandatory",
          "items": {
            "allOf": [
              {
                "$ref": "https://www.bfarm.de/schemas/genomde/data-types/Coding#"
              },
              {
                "required": [ "code", "system", "version" ]
              }
            ]
          },
          "minItems": 3
        },
        "diagnosisGMFCS": {
          "type": "string",
          "enum": [
            "I",
            "II",
            "III",
            "IV",
            "V"
          ],
          "description": "Age-appropriate information, empty if not applicable"
        }
      },
      "required": [
        "phenotypes",
        "HPOversion",
        "symptomOnsetDate",
        "molecularBoardDecisionDate",
        "diagnosticExtent",
        "diagnosis"
      ]
    },
    "priorRD": {
      "type": "object",
      "properties": {
        "genomicTestType": {
          "type": "string",
          "enum": [
            "exome",
            "genomeLongRead",
            "genomeShortRead",
            "panel",
            "single",
            "array",
            "kariotyping",
            "other"
          ],
          "description": "Type of diagnostics"
        },
        "diagnosticDate": {
          "type": "string",
          "format": "date",
          "description": "Date of diagnostics"
        },
        "diagnosticAssessment": {
          "type": "string",
          "enum": [
            "phenotypeNotCompletelyClarified",
            "structuralVariantWithUnclearBreakpoint",
            "heterozygousVariantInGeneticDisease",
            "noPathogenicVariantDetected",
            "other"
          ],
          "description": "Result of diagnostics"
        },
        "hospitalizationPeriods": {
          "type": "integer",
          "description": "Number of inpatient treatments in the last five years"
        },
        "hospitalizationDuration": {
          "type": "integer",
          "description": "Estimated duration of inpatient case-relevant pre-therapy in days"
        },
        "ZSEcontactDate": {
          "type": "string",
          "pattern": "^[0-9]{4}-(0[1-9]|1[0-2])$",
          "description": "Month and year of first contact with a specialized center for rare diseases"
        }
      },
      "required": [
        "genomicTestType",
        "diagnosticDate",
        "diagnosticAssessment",
        "hospitalizationPeriods",
        "hospitalizationDuration",
        "ZSEcontactDate"
      ]
    }
  }
}