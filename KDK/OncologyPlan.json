{
    "$id": "https://www.bfarm.de/schemas/genomde/OncologyPlan",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "OnkoPlan",
    "type": "object",
    "properties": {
        "carePlanOD": {
            "$ref": "#/$defs/carePlanOD"
        },
        "recommendedStudies": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/recommendedStudies"
            }
        },
        "recommendedSystemicTherapies": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/recommendedSystemicTherapies"
            }
        },
        "preventiveMeasures": {
            "type": "array",
            "items": {
                "$ref": "#/$defs/preventiveMeasures"
            }
        }
    },
    "$defs": {
        "Common": {
            "type": "object",
            "properties": {
                "identifier": {
                    "type": "string",
                    "description": "Study identifier."
                }
            }
        },
        "carePlanOD": {
            "type": "object",
            "properties": {
                "MolecularBoardDecisionDate": {
                    "type": "string",
                    "format": "date",
                    "description": "Date of case conference."
                },
                "StudyRecommended": {
                    "type": "boolean",
                    "description": "Recommendation to participate in a clinical study."
                },
                "counsellingRecommended": {
                    "type": "boolean",
                    "description": "Recommendation for human genetic counseling."
                },
                "reEvaluationRecommended": {
                    "type": "boolean",
                    "description": "Recommendation for diagnostic reevaluation."
                },
                "interventionRecommended": {
                    "type": "boolean",
                    "description": "Recommendation for an operation."
                },
                "interventionPurpose": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "therapeutic",
                            "riskReducing"
                        ],
                        "description": "Purpose of the operation."
                    },
                    "maxItems": 2
                },
                "interventionType": {
                    "type": "object",
                    "properties": {
                        "code": {
                            "allOf": [
                                {
                                    "$ref": "https://www.bfarm.de/schemas/genomde/data-types/Coding#"
                                },
                                {
                                    "type": "object",
                                    "required": [
                                        "code",
                                        "version"
                                    ]
                                }
                            ]
                        },
                        "name": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "code",
                        "name"
                    ]
                }
            },
            "required": [
                "MolecularBoardDecisionDate",
                "StudyRecommended",
                "counsellingRecommended",
                "reEvaluationRecommended",
                "interventionRecommended",
                "interventionType"
            ]
        },
        "recommendedStudies": {
            "type": "object",
            "properties": {
                "identifier": {
                    "$ref": "#/$defs/Common/properties/identifier"
                },
                "register": {
                    "type": "string",
                    "enum": [
                        "NCT",
                        "DRKS",
                        "EudraCT",
                        "other",
                        "yesButStudyIsUnknown"
                    ],
                    "description": "Study register."
                },
                "name": {
                    "type": "string",
                    "description": "Study name."
                },
                "id": {
                    "type": "string",
                    "description": "Study ID."
                },
                "substance": {
                    "type": "array",
                    "items": {
                        "type": "object",
                        "properties": {
                            "code": {
                                "allOf": [
                                    {
                                        "$ref": "https://www.bfarm.de/schemas/genomde/data-types/Coding#"
                                    },
                                    {
                                        "type": "object",
                                        "required": [
                                            "code",
                                            "system",
                                            "version"
                                        ]
                                    }
                                ]
                            },
                            "name": {
                                "type": "string"
                            }
                        },
                        "required": [
                            "code",
                            "name"
                        ]
                    }
                },
                "evidenceLevel": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "m1A",
                            "m1B",
                            "m1C",
                            "m2A",
                            "m2B",
                            "m2C",
                            "m3",
                            "m4",
                            "undefined"
                        ],
                        "description": "Evidence level."
                    }
                },
                "evidenceGrading": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "enum": [
                            "is",
                            "iv",
                            "Z",
                            "R"
                        ],
                        "description": "Additional references: evidence grading."
                    }
                },
                "priority": {
                    "type": "array",
                    "items": {
                        "type": "integer",
                        "description": "Prioritization."
                    },
                    "minItems": 1
                },
                "variants": {
                    "type": "array",
                    "items": {
                        "$ref": "https://www.bfarm.de/schemas/genomde/OncologyMolecular#/$defs/Variant"
                    }
                }
            },
            "required": [
                "identifier",
                "register",
                "name",
                "id",
                "priority"
            ]
        },
        "recommendedSystemicTherapies": {
            "type": "object",
            "properties": {
                "identifier": {
                   "$ref": "#/$defs/Common/properties/identifier"
                },
                "type": {
                    "type": "string",
                    "enum": [
                        "inLabel",
                        "offLabel",
                        "compassionateUse",
                        "unknown",
                        "secPreventive"
                    ],
                    "description": "Recommendation systemic therapy (outside of a clinical trial)"
                },
                "substance": {
                    "type": "object",
                    "properties": {
                        "code": {
                            "allOf": [
                                {
                                    "$ref": "https://www.bfarm.de/schemas/genomde/data-types/Coding#"
                                },
                                {
                                    "type": "object",
                                    "required": [
                                        "code",
                                        "system",
                                        "version"
                                    ]
                                }
                            ]
                        },
                        "name": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "code",
                        "name"
                    ]
                },
                "evidenceLevel": {
                    "type": "string",
                    "enum": [
                        "m1A",
                        "m1B",
                        "m1C",
                        "m2A",
                        "m2B",
                        "m2C",
                        "m3",
                        "m4",
                        "undefined"
                    ],
                    "description": "Evidence level."
                },
                "evidenceGrading": {
                    "type": "string",
                    "enum": [
                        "is",
                        "iv",
                        "Z",
                        "R"
                    ],
                    "description": "Additional references: evidence grading."
                },
                "priority": {
                    "type": "integer",
                    "description": "Prioritization."
                },
                "variants": {
                    "type": "array",
                    "items": {
                        "$ref": "https://www.bfarm.de/schemas/genomde/OncologyMolecular#/$defs/Variant"
                    }
                },
                "diagnosticAssessment": {
                    "type": "string",
                    "enum": [
                        "noGeneticDiagnosis",
                        "suspectedGeneticDiagnosis",
                        "furtherGeneticDiagnosisRecommended",
                        "confirmedGeneticDiagnosis",
                        "partialGeneticDiagnosis"
                    ],
                    "description": "Evaluation of genetic diagnostics (only for HT)."
                },
                "therapeuticStrategy": {
                    "type": "string",
                    "enum": [
                        "CH",
                        "HO",
                        "IM",
                        "ZS",
                        "SZ",
                        "CI",
                        "CZ",
                        "CIZ",
                        "IZ",
                        "WW",
                        "AS",
                        "WS",
                        "OP",
                        "ST",
                        "KW",
                        "SO"
                    ],
                    "description": "Type of therapy"
                }
            },
            "required": [
                "identifier",
                "type",
                "substance",
                "evidenceLevel",
                "evidenceGrading",
                "priority",
                "diagnosticAssessment",
                "therapeuticStrategy"
            ]
        },
        "preventiveMeasures": {
            "type": "object",
            "properties": {
                "identifier": {
                    "$ref": "#/$defs/Common/properties/identifier"
                },
                "type": {
                    "type": "string",
                    "description": "Breast Imaging (MRI, MGR, US) | Colonoscopy | Esophago-gastro-duodenoscopy"
                }
            },
            "required": [
                "identifier",
                "type"
            ]
        }
    }
}